# Ralph Progress Log

## Codebase Patterns
- Evaluation records persist baseline_answer, baseline_input_tokens, and baseline_context_window keys even when they are None.
- Use `UV_CACHE_DIR=/tmp/uv-cache` for `uv` commands in this sandbox to avoid cache permission errors.
- Use `NPM_CONFIG_CACHE=/tmp/npm-cache` for npm commands in this sandbox to avoid cache permission errors.
- If LocalStack state persists, set a unique `DDB_TABLE_PREFIX` for integration tests to avoid conditional write collisions.
- Prefer `pydantic.JsonValue` over self-recursive JSON type aliases to avoid schema recursion errors.
- API keys use HMAC-SHA256 with `API_KEY_PEPPER` and DDB PK/SK format `KEY#<hash>`.
- In FastAPI tests, override `get_settings` with `lambda: Settings()` to avoid Pydantic BaseSettings dependency resolution errors.
- BaseSettings fields with `validation_alias` are easiest to override via env vars (e.g., `S3_BUCKET`, `PARSER_SERVICE_URL`) instead of `Settings(field=...)`.
- Runtime execution state starts at turn_index -1 so the first step persists turn_index 0.
- Answerer executions currently persist an initial empty state at turn_index 0; orchestrator treats it as pre-step state.
- LLM cache keys hash deterministic JSON of provider, model, temperature, max_tokens, api_mode, reasoning_effort, verbosity, and prompt_sha256 to `cache/{tenant_id}/llm/{sha256}.json`.
- Step execution timeouts use SIGALRM and only enforce when signal timers are available.
- Worker containers select ingestion vs orchestrator via `WORKER_MODE`, with batch limits set by `INGESTION_BATCH_LIMIT` or `ORCHESTRATOR_BATCH_LIMIT` and sleep via `WORKER_POLL_INTERVAL_SECONDS`.
- API rate limits are stored in `app.state.rate_limiter` from `RATE_LIMITS_JSON` using `max_requests` and `window_seconds` (optional per-tenant overrides).
- Request size limits read `REQUEST_SIZE_LIMIT_BYTES` via `app.state.request_size_limit_bytes` and block oversized bodies in middleware.
- Metrics are exposed at `/metrics` when `ENABLE_METRICS=true`.
- When persisting float metrics to DynamoDB, run them through `_coerce_decimals` before `put_item`.
- When sending DynamoDB items through JSON (tests or API payloads), use `state_store.normalize_json_value` to coerce Decimal values.
- Contexts payloads use `storage/contexts.py` with the same inline size limit as state, offloading to `contexts_s3_uri` when too large.
- Context items now use a schema with sequence_index, turn_index, span_index, tag, text, text_char_length, source_name, mime_type, and ref; citations are built 1:1 from the same refs.
- `scripts/smoke_test.sh` writes JSON summaries to `SMOKE_OUTPUT_JSON`, and `KEEP_DOCKER=1` keeps LocalStack state across repeated runs.
- MCP server wrapper lives in `rlm_rs.mcp` and reads `RLM_BASE_URL` and `RLM_API_KEY` from env.
- Search tool resolution uses `SearchBackend`; disabled search records a spec-style error in tool results.
- Search indexing uses `SEARCH_BACKEND_CONFIG` with `chunk_size_chars`, `chunk_overlap_chars`, and `index_prefix`, and caches search results under `cache/{tenant_id}/search/{sha256}.json` (configurable via `cache_prefix`).
- Code logs are stored in the `code_log` DynamoDB table with PK `EXEC#<execution_id>` and SK `CODE#<zero-padded sequence>`; use `CodeLogWriter` to persist entries and apply trace redaction.
- Next.js pages that call `useSearchParams` must wrap the client component in a `Suspense` boundary to avoid build-time prerender errors.
- UI unit tests run via `npm run test --prefix ui`; use `@vitest-environment node` for Web Crypto coverage.

## Iteration Notes
- (append entries below using the format in prompt.md)

---

## 2026-01-18 - US-001
- Bootstrapped uv-based src layout with a minimal rlm_rs package and smoke test.
- Files changed: pyproject.toml, src/rlm_rs/__init__.py, tests/test_smoke.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: uv cache needs to live in a writable location for this sandbox.
  - Gotchas encountered: uv sync fails if cache defaults to the user cache directory.
---

## 2026-01-18 - US-002
- What was implemented: Added core Pydantic v2 schemas for budgets, tool requests, step I/O, span refs, and API request/response bodies.
- Files changed: pyproject.toml, src/rlm_rs/models.py, tests/unit/test_models.py, uv.lock, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k models; UV_CACHE_DIR=/tmp/uv-cache uv run python -c "from rlm_rs.models import StepEvent, StepResult; print(StepEvent.model_json_schema()['title'], StepResult.model_json_schema()['title'])"
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-003
- What was implemented: Added spec-aligned error envelope models, error codes, and raise_http_error helper.
- Files changed: src/rlm_rs/errors.py, tests/unit/test_errors.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-004
- What was implemented: Added env-driven settings with JSON blob parsing and feature flags; configured structlog JSON logging with context binding and optional trace context.
- Files changed: pyproject.toml, src/rlm_rs/settings.py, src/rlm_rs/logging.py, tests/unit/test_settings.py, uv.lock, src/rlm_rs.egg-info/requires.txt, src/rlm_rs.egg-info/PKG-INFO, src/rlm_rs.egg-info/SOURCES.txt, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q; UV_CACHE_DIR=/tmp/uv-cache uv run python -c "from rlm_rs.settings import Settings; s=Settings(); print('loaded', bool(s.aws_region))"
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-005
- What was implemented: Added compose LocalStack service config and an init script to create the S3 bucket and DynamoDB tables.
- Files changed: compose.yaml, scripts/localstack_init.sh, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-006
- What was implemented: Added S3 storage helpers with deterministic JSON serialization, gzip helpers, and basic unit tests for determinism.
- Files changed: pyproject.toml, uv.lock, src/rlm_rs/storage/__init__.py, src/rlm_rs/storage/s3.py, tests/unit/test_s3.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k s3
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-007
- What was implemented: Added DynamoDB storage helpers with status transitions and execution lease support plus LocalStack integration coverage.
- Files changed: src/rlm_rs/storage/ddb.py, tests/integration/test_ddb_s3_roundtrip.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/integration -k ddb_s3_roundtrip; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-008
- What was implemented: Added JSON-only state validation with inline versus S3 offload policy, deterministic checksum/summary metadata, and unit coverage.
- Files changed: src/rlm_rs/storage/state.py, tests/unit/test_state.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k state_json_validation
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-009
- What was implemented: Added parser service models, a FastAPI /parse implementation that writes deterministic text/meta/offset outputs, and an HTTP client with retries plus unit coverage for deterministic outputs.
- Files changed: pyproject.toml, uv.lock, src/rlm_rs/parser/__init__.py, src/rlm_rs/parser/models.py, src/rlm_rs/parser/service.py, src/rlm_rs/parser/client.py, tests/unit/test_parser_service.py, src/rlm_rs.egg-info/PKG-INFO, src/rlm_rs.egg-info/SOURCES.txt, src/rlm_rs.egg-info/requires.txt, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-010
- What was implemented: Added sandbox AST policy enforcement and unit coverage for banned nodes, names, modules, and dunder attribute access.
- Files changed: src/rlm_rs/sandbox/ast_policy.py, src/rlm_rs/sandbox/__init__.py, tests/unit/test_ast_policy.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k ast_policy
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-011
- What was implemented: Added ContextView/DocView with S3-backed range reads and span logging plus unit coverage.
- Files changed: src/rlm_rs/sandbox/context.py, src/rlm_rs/sandbox/__init__.py, tests/unit/test_context.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k span_logging
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-012
- What was implemented: Added sandbox ToolAPI queueing with limit enforcement plus unit coverage for queueing, yield/final signals, and max request limits.
- Files changed: src/rlm_rs/sandbox/tool_api.py, tests/unit/test_tool_api.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-013
- What was implemented: Added sandbox step executor with AST checks, restricted builtins, stdout truncation, and limit enforcement plus Lambda/local adapters and unit coverage.
- Files changed: src/rlm_rs/sandbox/step_executor.py, src/rlm_rs/sandbox/lambda_handler.py, src/rlm_rs/sandbox/__init__.py, tests/unit/test_step_executor_limits.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k step_executor_limits
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-014
- What was implemented: Added citation checksum utilities with NFC normalization, span merge/dedup helpers, and SpanRef builders plus unit coverage.
- Files changed: src/rlm_rs/orchestrator/__init__.py, src/rlm_rs/orchestrator/citations.py, tests/unit/test_citations.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k checksum_determinism
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-015
- What was implemented: Added FastAPI app skeleton with health endpoints plus dependencies for settings, logging, and storage readiness checks.
- Files changed: src/rlm_rs/api/__init__.py, src/rlm_rs/api/app.py, src/rlm_rs/api/dependencies.py, src/rlm_rs/api/health.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-016
- What was implemented: Added API key auth dependency with HMAC hashing, DDB lookup, tenant guard helper, and error envelope handling plus unit coverage.
- Files changed: src/rlm_rs/api/auth.py, src/rlm_rs/api/app.py, src/rlm_rs/settings.py, tests/unit/test_api_auth.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: API keys are validated via HMAC-SHA256 hashes and DDB PK/SK KEY#<hash>.
  - Gotchas encountered: Settings reads API_KEY_PEPPER via env aliases, so tests should set env vars.
---
## 2026-01-18 - US-017
- What was implemented: Added /v1/sessions create/get/delete endpoints with DDB persistence, readiness calculation, and tenant enforcement plus unit coverage.
- Files changed: src/rlm_rs/api/app.py, src/rlm_rs/api/sessions.py, tests/unit/test_api_sessions.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k api_sessions; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: Override FastAPI settings dependency with a lambda to avoid BaseSettings signature issues in tests.
  - Gotchas encountered: none
---
## 2026-01-18 - US-018
- What was implemented: Added Answerer execution create/get/wait endpoints with DDB persistence, readiness gating, and JSON-only state initialization plus unit coverage.
- Files changed: src/rlm_rs/api/executions.py, src/rlm_rs/api/app.py, tests/unit/test_api_executions.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-019
- What was implemented: Added runtime execution endpoints for step execution and tool resolution, persisted per-step output, and a fake tool resolver with unit coverage.
- Files changed: src/rlm_rs/api/executions.py, src/rlm_rs/storage/ddb.py, tests/unit/test_api_runtime.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: Runtime tool resolution persists into state under _tool_results and _tool_status, enabling subsequent steps to read results.
  - Gotchas encountered: none
---
## 2026-01-18 - US-020
- What was implemented: Added /v1/spans/get and /v1/citations/verify endpoints that read parsed text via offsets, compute span checksums, and verify citations.
- Files changed: src/rlm_rs/api/spans.py, src/rlm_rs/api/app.py, tests/unit/test_api_spans.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-021
- What was implemented: Added ingestion worker polling DDB for registered/parsing docs, invoking the parser client, updating document pointers/checksums, and marking LAX sessions READY with unit coverage and idempotent re-runs.
- Files changed: src/rlm_rs/ingestion/__init__.py, src/rlm_rs/ingestion/worker.py, tests/unit/test_ingestion_worker.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: Settings overrides in tests should use env aliases for BaseSettings fields.
  - Gotchas encountered: none
---
## 2026-01-18 - US-022
- What was implemented: Added root prompt builder templates for subcalls enabled or disabled and a strict root output parser that enforces a single repl code block.
- Files changed: src/rlm_rs/orchestrator/root_prompt.py, tests/unit/test_root_output_parser.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k root_output_parser
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-023
- What was implemented: Added Answerer orchestrator worker with budget enforcement, FakeLLMProvider, tool resolution, and citations; added LocalStack integration coverage.
- Files changed: src/rlm_rs/orchestrator/providers.py, src/rlm_rs/orchestrator/worker.py, src/rlm_rs/orchestrator/__init__.py, tests/integration/test_orchestrator_answerer.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: Answerer executions store an initial empty state at turn_index 0 that should be treated as pre-step state.
  - Gotchas encountered: none
---
## 2026-01-18 - US-024
- What was implemented: Added OpenAI provider integration with tenacity retries, S3-backed caching, and settings/build_worker wiring plus cache hit unit coverage.
- Files changed: pyproject.toml, uv.lock, src/rlm_rs/orchestrator/providers.py, src/rlm_rs/orchestrator/worker.py, src/rlm_rs/orchestrator/__init__.py, src/rlm_rs/settings.py, tests/unit/test_openai_provider_cache.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: LLM subcall caching uses the cache/{tenant_id}/llm/{sha256}.json layout with deterministic key hashing.
  - Gotchas encountered: none
---
## 2026-01-18 - US-025
- What was implemented: Added an end-to-end smoke test script that boots LocalStack and services, runs ingestion and orchestration loops, and verifies citations.
- Files changed: scripts/smoke_test.sh, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-026
- What was implemented: Added step timeout enforcement and unit coverage for infinite loop protection in the sandbox executor.
- Files changed: src/rlm_rs/sandbox/step_executor.py, tests/unit/test_step_executor_limits.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: Step execution timeouts use SIGALRM when available.
  - Gotchas encountered: none
---
## 2026-01-18 - US-027
- What was implemented: Added Dockerfiles for API, parser, and worker images, a worker entrypoint for orchestrator or ingestion mode, Compose services for runtime, and a documented .env.example.
- Files changed: compose.yaml, docker/api.Dockerfile, docker/worker.Dockerfile, docker/parser.Dockerfile, src/rlm_rs/worker_entrypoint.py, .env.example, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: Worker containers select ingestion vs orchestrator via WORKER_MODE with batch limits and poll interval envs.
  - Gotchas encountered: none
---
## 2026-01-18 - US-028
- What was implemented: Added per-tenant rate limiting, request size middleware, metrics and tracing wiring, trace option gating, and regression coverage.
- Files changed: .env.example, pyproject.toml, uv.lock, src/rlm_rs/api/app.py, src/rlm_rs/api/executions.py, src/rlm_rs/api/rate_limits.py, src/rlm_rs/api/request_limits.py, src/rlm_rs/api/sessions.py, src/rlm_rs/api/spans.py, src/rlm_rs/errors.py, src/rlm_rs/observability.py, src/rlm_rs/settings.py, src/rlm_rs/storage/ddb.py, tests/unit/test_api_executions.py, tests/unit/test_api_limits.py, tests/unit/test_metrics.py, tests/unit/test_step_executor_limits.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: Rate limits and request size limits are enforced via app.state-backed middleware/dependencies, and metrics expose /metrics when ENABLE_METRICS=true.
  - Gotchas encountered: none
---
## 2026-01-18 - US-029
- What was implemented: Added a load test harness that runs smoke tests with a warmup, emits per-iteration metrics, and writes a JSON artifact.
- Files changed: scripts/smoke_test.sh, scripts/load_test.sh, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: Smoke tests can emit JSON summaries via SMOKE_OUTPUT_JSON for automation.
  - Gotchas encountered: none
---
## 2026-01-18 - US-030
- What was implemented: Added FastMCP-based MCP server wrapper that forwards tool calls to the HTTP API with httpx.
- Files changed: pyproject.toml, uv.lock, src/rlm_rs.egg-info/PKG-INFO, src/rlm_rs.egg-info/SOURCES.txt, src/rlm_rs.egg-info/requires.txt, src/rlm_rs/mcp/__init__.py, src/rlm_rs/mcp/__main__.py, src/rlm_rs/mcp/server.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: MCP server tools are registered via FastMCP and forward JSON to the HTTP API.
  - Gotchas encountered: none
---
## 2026-01-18 - US-031
- What was implemented: Added a SearchBackend interface with a deterministic FakeSearchBackend and wired orchestrator tool resolution to emit spec-style errors when search is disabled.
- Files changed: src/rlm_rs/search/backends.py, src/rlm_rs/search/__init__.py, src/rlm_rs/orchestrator/worker.py, tests/unit/test_search_backend.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: Search tool resolution writes error metadata into tool results when search is disabled.
  - Gotchas encountered: none
---
## 2026-01-18 - US-032
- What was implemented: Added search indexing during ingestion with PARSED -> INDEXING -> INDEXED transitions, plus S3-backed search caching and chunking config.
- Files changed: AGENTS.md, scripts/ralph/prd.json, scripts/ralph/progress.txt, src/rlm_rs/ingestion/worker.py, src/rlm_rs/orchestrator/worker.py, src/rlm_rs/search/__init__.py, src/rlm_rs/search/backends.py, src/rlm_rs/search/indexing.py, src/rlm_rs/storage/ddb.py, tests/unit/test_ingestion_worker.py, tests/unit/test_search_backend.py
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q
- **Learnings:**
  - Patterns discovered: Search indexing/caching configuration lives in SEARCH_BACKEND_CONFIG with chunk sizing and prefix controls.
  - Gotchas encountered: none
---
## 2026-01-18 - US-033
- What was implemented: Bootstrapped Next.js UI app with TypeScript, Tailwind, ESLint, strict tsconfig, and placeholder homepage; adjusted integration tests to use unique IDs to avoid DDB collisions during LocalStack runs.
- Files changed: ui/package.json, ui/tsconfig.json, ui/.eslintrc.json, ui/eslint.config.mjs, ui/src/app/page.tsx, tests/integration/test_ddb_s3_roundtrip.py, tests/integration/test_orchestrator_answerer.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run build --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run dev --prefix ui -- --hostname 127.0.0.1 --port 3000; curl -sS http://127.0.0.1:3000
- **Learnings:**
  - Patterns discovered: npm cache needs to live in a writable location for this sandbox.
  - Gotchas encountered: none
---
## 2026-01-18 - US-034
- What was implemented: Added shared UI TypeScript types, ApiClient with error handling, LocalStack-aware S3/DDB helpers, and config defaults; added AWS SDK deps.
- Files changed: AGENTS.md, ui/package.json, ui/package-lock.json, ui/src/lib/types.ts, ui/src/lib/api-client.ts, ui/src/lib/config.ts, ui/src/lib/s3-client.ts, ui/src/lib/ddb-client.ts, ui/src/lib/crypto.ts, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; docker compose build rlm-ui (fails: buildx activity permission error)
- **Learnings:**
  - Patterns discovered: LocalStack integration tests can avoid stale data by overriding `DDB_TABLE_PREFIX`.
  - Gotchas encountered: none
---
## 2026-01-18 - US-035
- What was implemented: Added toast UI and provider plus AppContext with health polling, configurable settings, and running execution count tracking.
- Files changed: ui/src/components/ui/toast.tsx, ui/src/contexts/ToastContext.tsx, ui/src/contexts/AppContext.tsx, ui/src/app/layout.tsx, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run build --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-18 - US-036
- What was implemented: Added AppShell layout with top bar and sidebar navigation, health badges, running execution count, and mobile sidebar toggle; refreshed homepage content to fit the shell.
- Files changed: ui/src/components/layout/AppShell.tsx, ui/src/components/layout/Sidebar.tsx, ui/src/components/layout/TopBar.tsx, ui/src/app/layout.tsx, ui/src/app/page.tsx, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run build --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-037
- What was implemented: Added auto-seed hook and seed helpers for LocalStack API keys plus a crypto hash test and layout wiring.
- Files changed: ui/src/lib/seed.ts, ui/src/hooks/useAutoSeed.ts, ui/src/components/layout/AutoSeed.tsx, ui/src/app/layout.tsx, ui/src/lib/crypto.test.ts, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-038
- What was implemented: Added Sessions page with upload form, progress-aware S3 upload, session creation flow, and sessions table with loading and empty states.
- Files changed: ui/src/app/sessions/page.tsx, ui/src/lib/api-client.ts, ui/src/lib/s3-client.ts, ui/src/lib/types.ts, ui/package.json, ui/package-lock.json, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-039
- What was implemented: Added session detail screen with status header, polling, doc table, parsed text drawer, and placeholder start modals; expanded session API response to include created/expires timestamps and doc metadata needed by the UI.
- Files changed: src/rlm_rs/models.py, src/rlm_rs/api/sessions.py, ui/src/lib/types.ts, ui/src/app/sessions/[session_id]/page.tsx, ui/src/components/modals/StartAnswererModal.tsx, ui/src/components/modals/StartRuntimeModal.tsx, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-040
- What was implemented: Replaced the Answerer start modal with full form submission flow and added the Answerer execution detail page with status, budgets, answer, and citations views.
- Files changed: ui/src/components/modals/StartAnswererModal.tsx, ui/src/app/sessions/[session_id]/page.tsx, ui/src/app/executions/[execution_id]/page.tsx, ui/src/lib/types.ts, src/rlm_rs/models.py, src/rlm_rs/api/executions.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-041
- What was implemented: Built the runtime execution editor with multi-step editing, run controls, output inspector tabs, and wired runtime start/reset flows.
- Files changed: ui/src/components/modals/StartRuntimeModal.tsx, ui/src/app/sessions/[session_id]/page.tsx, ui/src/app/executions/[execution_id]/runtime/page.tsx, ui/src/lib/types.ts, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-042
- What was implemented: Added the Citation Viewer screen with query-param parsing, metadata display, excerpt highlighting with adjustable context, and citation verification feedback.
- Files changed: ui/src/app/citations/page.tsx, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-043
- What was implemented: Added the executions list screen with filters, pagination, auto-refresh, and local execution tracking for Answerer/Runtime starts.
- Files changed: ui/src/app/executions/page.tsx, ui/src/lib/executions-store.ts, ui/src/components/modals/StartAnswererModal.tsx, ui/src/components/modals/StartRuntimeModal.tsx, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-044
- What was implemented: Added the Debug Console screen with health panels, request/error logs, and editable configuration plus ApiClient request logging.
- Files changed: ui/src/app/debug/page.tsx, ui/src/lib/request-log.ts, ui/src/lib/api-client.ts, ui/src/lib/ddb-client.ts, ui/src/contexts/AppContext.tsx, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---

## 2026-01-19 - US-045
- What was implemented: Added shared Skeleton and EmptyState components, standardized API error panels, and wired error boundaries plus Next.js error/not-found pages with Suspense wrappers for search-param pages.
- Files changed: AGENTS.md, scripts/ralph/prd.json, scripts/ralph/progress.txt, ui/src/components/ui/Skeleton.tsx, ui/src/components/ui/EmptyState.tsx, ui/src/components/ui/ErrorPanel.tsx, ui/src/components/ErrorBoundary.tsx, ui/src/components/layout/AppShell.tsx, ui/src/app/error.tsx, ui/src/app/not-found.tsx, ui/src/app/sessions/page.tsx, ui/src/app/sessions/[session_id]/page.tsx, ui/src/app/executions/[execution_id]/page.tsx, ui/src/app/executions/page.tsx, ui/src/app/executions/ExecutionsPageClient.tsx, ui/src/app/debug/page.tsx, ui/src/app/citations/page.tsx, ui/src/app/citations/CitationsPageClient.tsx
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run build --prefix ui
- **Learnings:**
  - Patterns discovered: Next.js pages that call useSearchParams must be wrapped in Suspense via a server wrapper to avoid build-time prerender errors.
  - Gotchas encountered: pytest integration tests can fail if DDB_TABLE_PREFIX is not unique.
---
## 2026-01-19 - US-046
- What was implemented: Added UI Dockerfile, enabled Next.js standalone output, and wired rlm-ui into docker compose.
- Files changed: compose.yaml, docker/ui.Dockerfile, ui/next.config.js, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-047
- What was implemented: Added Playwright MCP server config, E2E screenshots directory, and a runner script that boots the UI dev server and executes E2E scripts.
- Files changed: .claude/settings.local.json, scripts/e2e/run-e2e-tests.sh, ui/tests/e2e/screenshots/.gitkeep, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-048
- What was implemented: Documented Playwright MCP E2E steps for app shell and navigation checks.
- Files changed: scripts/e2e/test-app-shell.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-049
- What was implemented: Documented Playwright MCP E2E steps for session creation and added the test fixture document.
- Files changed: scripts/e2e/test-sessions.md, ui/tests/e2e/fixtures/test-doc.txt, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-050
- What was implemented: Documented Playwright MCP E2E steps for Answerer execution flow including screenshots and citation verification.
- Files changed: scripts/e2e/test-answerer.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-051
- What was implemented: Documented Playwright MCP E2E steps for Runtime multi-step execution flow with screenshots and assertions.
- Files changed: scripts/e2e/test-runtime.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-052
- What was implemented: Documented Playwright MCP E2E steps for the Debug Console screen, including screenshots and assertions.
- Files changed: scripts/e2e/test-debug.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---

## 2026-01-19 - US-053
- What was implemented: Documented Playwright MCP E2E steps for the Executions list filters and navigation checks.
- Files changed: scripts/e2e/test-executions-list.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-054
- What was implemented: Documented Playwright MCP E2E steps for responsive layout checks with required screenshots.
- Files changed: scripts/e2e/test-responsive.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-055
- What was implemented: Added UI smoke test script to boot compose services, wait for API/UI health, and list E2E screenshots; documented ordered Playwright MCP test checklist.
- Files changed: scripts/ui_smoke_test.sh, scripts/e2e/run-all-tests.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-056
- What was implemented: Added /v1/executions list endpoint with filtering and cursor pagination plus unit and LocalStack integration coverage.
- Files changed: src/rlm_rs/models.py, src/rlm_rs/api/executions.py, tests/unit/test_api_executions.py, tests/integration/test_list_executions_api.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k list_executions; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/integration -k list_executions
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-19 - US-057
- What was implemented: Added GET /v1/sessions with cursor pagination, status filtering, and session list models plus unit coverage.
- Files changed: src/rlm_rs/models.py, src/rlm_rs/api/sessions.py, tests/unit/test_api_sessions.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-21 - US-058
- What was implemented: Added evaluation table names and helpers, evaluation models, LocalStack init for evaluations, and unit coverage for evaluation records.
- Files changed: src/rlm_rs/storage/ddb.py, src/rlm_rs/models.py, scripts/localstack_init.sh, tests/unit/test_api_auth.py, tests/unit/test_api_sessions.py, tests/unit/test_api_limits.py, tests/unit/test_api_spans.py, tests/unit/test_ingestion_worker.py, tests/unit/test_api_executions.py, tests/unit/test_api_runtime.py, tests/unit/test_evaluations.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k evaluation
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-21 - US-059
- What was implemented: Added baseline prompt builder with OpenAI Responses token fit checks, plus settings and env wiring for model context windows.
- Files changed: .env.example, compose.yaml, scripts/ralph/prd.json, scripts/ralph/progress.txt, src/rlm_rs/orchestrator/baseline.py, src/rlm_rs/settings.py, tests/unit/test_baseline.py
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k baseline
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-21 - US-060
- What was implemented: Added baseline evaluation creation on answerer completion with fit checks and persistence plus integration coverage for answerer/runtime evaluation records.
- Files changed: src/rlm_rs/orchestrator/baseline.py, src/rlm_rs/orchestrator/providers.py, src/rlm_rs/orchestrator/worker.py, tests/unit/test_baseline.py, tests/integration/test_evaluation.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k baseline; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/integration -k evaluation
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: Integration tests skip when LocalStack is unavailable.
---
## 2026-01-21 - US-061
- What was implemented: Added evaluation response model and GET /v1/executions/{execution_id}/evaluation with runtime guard, tenant checks, and unit coverage.
- Files changed: src/rlm_rs/models.py, src/rlm_rs/api/executions.py, tests/unit/test_api_executions.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k evaluation_api
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---

## 2026-01-21 - US-062
- What was implemented: Added Ragas-based judge evaluation with env-configured settings, persisted judge metrics on evaluation records, and unit coverage with mocked judge execution.
- Files changed: .env.example, compose.yaml, pyproject.toml, uv.lock, src/rlm_rs/settings.py, src/rlm_rs/models.py, src/rlm_rs/storage/ddb.py, src/rlm_rs/api/executions.py, src/rlm_rs/orchestrator/worker.py, src/rlm_rs/orchestrator/eval_judge.py, tests/unit/test_eval_judge.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k eval_judge
- **Learnings:**
  - Patterns discovered: Persisting float metrics to DynamoDB requires Decimal coercion via _coerce_decimals.
  - Gotchas encountered: none
---
## 2026-01-21 - US-063
- What was implemented: Added evaluation types and client fetch, plus a Baseline panel on execution detail with status, tokens, skip reason, and answer rendering alongside Answer; ensured evaluation records persist baseline fields even when null.
- Files changed: ui/src/lib/types.ts, ui/src/lib/api-client.ts, ui/src/app/executions/[execution_id]/page.tsx, src/rlm_rs/storage/ddb.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui
- **Learnings:**
  - Patterns discovered: Evaluation records keep baseline_* keys even when values are null.
  - Gotchas encountered: Integration tests expect explicit baseline_* null fields in DDB evaluation items.
---
## 2026-01-21 - US-064
- What was implemented: Added the Evaluation section on execution detail to surface LLM judge metrics with formatted scores and empty-state handling.
- Files changed: ui/src/app/executions/[execution_id]/page.tsx, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-22 - US-068
- What was implemented: Added code logging models, storage helpers, API endpoint, orchestrator/runtime logging, and UI Code panel with filters and polling.
- Files changed: src/rlm_rs/models.py, src/rlm_rs/storage/ddb.py, src/rlm_rs/code_log.py, src/rlm_rs/orchestrator/worker.py, src/rlm_rs/api/executions.py, scripts/localstack_init.sh, tests/unit/test_code_log.py, tests/integration/test_orchestrator_answerer.py, tests/unit/test_eval_judge.py, tests/unit/test_api_auth.py, tests/unit/test_api_executions.py, tests/unit/test_api_limits.py, tests/unit/test_api_runtime.py, tests/unit/test_api_sessions.py, tests/unit/test_api_spans.py, tests/unit/test_ingestion_worker.py, ui/src/lib/types.ts, ui/src/lib/api-client.ts, ui/src/app/executions/[execution_id]/page.tsx
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui
- **Learnings:**
  - Patterns discovered: Code logs use the code_log table with EXEC# and CODE# keys, written via CodeLogWriter.
  - Gotchas encountered: Eval judge FakeTable needs update_item support for update_evaluation.
---
## 2026-01-22 - US-069
- What was implemented: Added a CodeBlock component for REPL logs with preserved whitespace, wired it into the execution Code panel, and introduced Vitest-backed UI unit tests.
- Files changed: ui/package-lock.json, ui/package.json, ui/src/app/executions/[execution_id]/page.tsx, ui/src/components/ui/CodeBlock.test.tsx, ui/src/components/ui/CodeBlock.tsx, ui/src/lib/crypto.test.ts, ui/vitest.config.ts, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_test_$(date +%s) uv run pytest -q; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run lint --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm run test --prefix ui
- **Learnings:**
  - Patterns discovered: Vitest runs UI unit tests via `npm run test --prefix ui` with per-file environment overrides.
  - Gotchas encountered: Existing Node test files need migration to Vitest to avoid empty-suite failures.
---
## 2026-01-28 - US-001
- What was implemented: Added execution output_mode with ANSWER/CONTEXTS defaults in models and API responses, persisted options to DynamoDB, and added unit coverage for output_mode handling.
- Files changed: src/rlm_rs/models.py, src/rlm_rs/api/executions.py, tests/unit/test_api_executions.py, tests/unit/test_sandbox_runner.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k execution_output_mode
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-28 - US-002
- What was implemented: Added contexts-mode root prompt instructions, contexts-only finalization with tagged span filtering, and integration coverage with citation verification.
- Files changed: src/rlm_rs/orchestrator/root_prompt.py, src/rlm_rs/orchestrator/worker.py, src/rlm_rs/storage/ddb.py, src/rlm_rs/finetune/traces.py, tests/integration/test_orchestrator_answerer.py, tests/integration/AGENTS.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/integration -k answerer_contexts
- **Learnings:**
  - Patterns discovered: DynamoDB Decimal values need normalization (via state_store.normalize_json_value) before JSON encoding.
  - Gotchas encountered: citations pulled from DDB include Decimal values that break JSON encoding without normalization.
---
## 2026-01-28 - US-003
- What was implemented: Added contexts payload persistence with inline vs S3 offload, contexts retrieval endpoint, and unit coverage for offload roundtrip plus API access.
- Files changed: src/rlm_rs/storage/contexts.py, src/rlm_rs/storage/ddb.py, src/rlm_rs/orchestrator/worker.py, src/rlm_rs/models.py, src/rlm_rs/api/executions.py, src/rlm_rs/storage/AGENTS.md, tests/unit/test_contexts_payload.py, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k contexts_payload
- **Learnings:**
  - Patterns discovered: Contexts payloads offload through storage/contexts with contexts_s3_uri when exceeding the inline size limit.
  - Gotchas encountered: none
---
## 2026-01-28 - US-004
- What was implemented: Added ContextItem schema with sequence/turn/span metadata, updated contexts construction and validation, and aligned unit/integration coverage.
- Files changed: src/rlm_rs/models.py, src/rlm_rs/orchestrator/citations.py, src/rlm_rs/orchestrator/worker.py, src/rlm_rs/storage/contexts.py, src/rlm_rs/api/executions.py, tests/unit/test_contexts_payload.py, tests/unit/test_context_schema.py, tests/integration/test_orchestrator_answerer.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k context_schema
- **Learnings:**
  - Patterns discovered: Context items carry sequence_index, turn_index, span_index, tag, text, text_char_length, source_name, mime_type, and ref for 1:1 citation mapping.
  - Gotchas encountered: none
---
## 2026-01-28 - US-005
- What was implemented: Added turn_index to root REPL code log entries, exposed it in API and UI types, and added unit coverage for multi-turn ordering.
- Files changed: src/rlm_rs/code_log.py, src/rlm_rs/orchestrator/worker.py, src/rlm_rs/models.py, src/rlm_rs/api/executions.py, ui/src/lib/types.ts, tests/unit/test_code_log_turn_index.py, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit -k code_log_turn_index
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-28 - US-006
- What was implemented: Added Answerer Output Mode selector (Answer vs Contexts), sent output_mode on create, and surfaced Contexts badges for Answerer executions; updated cache-key unit test to include api_mode.
- Files changed: ui/src/components/modals/StartAnswererModal.tsx, ui/src/app/executions/ExecutionsPageClient.tsx, ui/src/lib/types.ts, tests/unit/test_openai_provider_cache.py, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm test --prefix ui
- **Learnings:**
  - Patterns discovered: LLM cache keys include api_mode in the deterministic hash payload.
  - Gotchas encountered: none
---
## 2026-01-28 - US-007
- What was implemented: Added contexts-mode UI on execution detail with timeline, inspector, and S3-backed context fetch; hid answer/baseline/evaluation in contexts mode and surfaced repl code per turn.
- Files changed: ui/src/app/executions/[execution_id]/page.tsx, ui/src/lib/api-client.ts, ui/src/lib/types.ts, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache uv run pytest -q tests/unit; NPM_CONFIG_CACHE=/tmp/npm-cache npm run typecheck --prefix ui; NPM_CONFIG_CACHE=/tmp/npm-cache npm test --prefix ui
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: none
---
## 2026-01-28 - US-008
- What was implemented: Documented contexts output_mode behavior, context schema fields, and UI layout updates in specs.
- Files changed: docs/rls_spec.md, docs/sequence.md, docs/ui_spec.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- Verification run (exact commands): UV_CACHE_DIR=/tmp/uv-cache uv run ruff check .; UV_CACHE_DIR=/tmp/uv-cache DDB_TABLE_PREFIX=rlm_20260128_1 uv run pytest -q
- **Learnings:**
  - Patterns discovered: none
  - Gotchas encountered: LocalStack state required a unique DDB_TABLE_PREFIX to avoid conditional write collisions; .git is read-only in this environment, so git add and git commit failed.
---
